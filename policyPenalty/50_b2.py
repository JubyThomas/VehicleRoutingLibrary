#!/usr/bin/env python3
# Copyright 2010-2021 Google LLC
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# [START program]
"""Capacited Vehicles Routing Problem (CVRP)."""

# [START import]
from ortools.constraint_solver import routing_enums_pb2
from ortools.constraint_solver import pywrapcp
import random
import numpy as np
# [END import]

dictSort={}
drop_nodes = []
mandatoryNodes=[]
mandatoryNodesById=[]
binSize=50 # we assume the bin size is 50 L for all our experiment
bin_fill_level=0.70
drop_nodes_greater_than70=[]
# [START data_model]



def create_data_model():
    """Stores the data for the problem."""
    data = {}
    data['distance_matrix'] =np.array([
                         [0.0, 379.44, 218.05, 113.53, 106.78, 93.9, 269.05, 245.45, 130.21, 161.05, 304.0, 243.21, 339.09, 98.47, 32.25,
                          278.15, 75.47, 287.11, 50.45, 380.95, 285.93, 391.5, 165.52, 54.59, 76.92, 208.43, 266.39, 418.12, 57.43, 149.01, 
                          165.74, 62.03, 296.0, 259.79, 262.19, 101.87, 342.91, 7.0, 307.79, 372.34, 127.88, 229.34, 351.62, 287.39, 389.51,
                          305.35, 316.17, 317.1, 408.35, 356.0], [379.44, 0.0, 241.02, 283.62, 276.06, 297.09, 371.61, 379.27, 249.54, 
                          457.22, 331.51, 138.22, 200.69, 281.02, 408.68, 317.05, 312.62, 223.49, 398.96, 142.9, 242.17, 62.61, 456.0,
                          433.87, 447.3, 228.79, 379.72, 341.74, 418.71, 231.21, 355.86, 351.32, 331.18, 143.78, 293.97, 285.39, 158.47, 
                          375.66, 229.26, 343.23, 441.48, 342.35, 39.62, 363.47, 125.42, 133.82, 244.03, 215.0, 387.24, 190.88], 
                          [218.05, 241.02, 0.0, 196.33, 128.02, 191.67, 384.4, 141.16, 130.05, 361.9, 125.6, 128.81, 122.87, 148.05,
                          234.83, 100.5, 144.81, 69.08, 261.22, 178.6, 69.46, 221.02, 364.32, 261.77, 294.7, 20.62, 146.15, 460.35,
                          274.18, 120.21, 119.62, 162.5, 120.62, 98.73, 331.69, 181.34, 136.5, 211.51, 322.45, 433.38, 332.78,
                          340.6, 202.25, 139.85, 193.13, 254.17, 338.01, 320.22, 479.42, 141.4],
                          [113.53, 283.62, 196.33, 0.0, 75.29, 20.1, 196.09, 285.41, 66.48, 182.26, 313.68, 158.65, 297.62, 55.22, 
                          145.77, 286.54, 90.21, 257.19, 117.48, 318.51, 263.49, 307.95, 182.73, 165.2, 167.36, 178.49, 302.06,
                          316.69, 137.93, 80.16, 211.44, 125.8, 306.95, 191.32, 163.92, 19.1, 287.65, 113.07, 196.79, 275.81, 
                          160.91, 151.73, 262.23, 312.37, 321.57, 193.87, 206.65, 204.88, 316.81, 309.9], 
                          [106.78, 276.06, 128.02, 75.29, 0.0, 65.52, 271.28, 210.88, 30.02, 234.63, 239.71,
                          138.23, 241.09, 20.88, 133.6, 212.51, 37.0, 194.03, 139.98, 276.13, 197.25, 284.95, 
                          236.78, 159.79, 181.4, 113.0, 227.04, 381.28, 156.25, 45.54, 139.63, 78.26, 232.76,
                          153.15, 233.77, 57.27, 239.71, 101.91, 251.85, 344.25, 206.65, 226.88, 246.29, 237.12, 
                          283.65, 221.0, 264.37, 256.16, 387.11, 256.22], 
                          [93.9, 297.09, 191.67, 20.1, 65.52, 0.0, 209.44, 272.09, 65.12, 177.12, 305.2, 168.0, 298.39,
                          44.64, 126.15, 277.99, 73.55, 255.2, 102.0, 323.93, 260.12, 318.29, 178.31, 146.29,
                          151.17, 175.03, 289.5, 335.68, 122.07, 81.91, 196.43, 106.89, 298.2, 196.89, 181.97, 
                          12.53, 291.25, 93.19, 216.84, 293.97, 152.97, 165.42, 273.86, 301.47, 328.26, 212.26,
                          226.59, 224.98, 334.25, 311.73],
                          [269.05, 371.61, 384.4, 196.09, 271.28, 209.44, 0.0, 481.27, 257.16, 182.04, 506.73, 301.4, 
                          465.58, 251.29, 293.97, 479.86, 282.45, 436.53, 233.9, 463.0, 446.54, 420.53, 176.14, 297.95, 
                          269.12, 364.72, 498.14, 179.05, 247.92, 264.32, 405.76, 309.79, 500.43, 347.2, 78.19, 214.72, 
                          443.72, 273.07, 155.32, 126.15, 196.86, 44.42, 370.41, 507.99, 458.39, 238.76, 147.27, 172.51,
                          148.12, 472.82], 
                          [245.45, 379.27, 141.16, 285.41, 210.88, 272.09, 481.27, 0.0, 230.53, 406.49, 89.87, 268.53,
                           215.35, 230.23, 243.61, 79.76, 200.69, 165.74, 295.89, 289.36, 149.16, 350.89, 410.91, 264.27,
                           308.1, 158.11, 22.09, 585.19, 299.72, 230.85, 80.01, 185.31, 82.73, 239.46, 443.38, 266.6,
                           248.5, 238.67, 449.77, 552.07, 373.28, 437.02, 339.85, 52.33, 308.59, 391.54, 464.22, 450.16, 
                           596.16, 235.64], 
                           [130.21, 249.54, 130.05, 66.48, 30.02, 65.12, 257.16, 230.53, 0.0, 241.9, 249.69, 113.07, 
                           233.28, 31.89, 159.15, 222.75, 66.29, 191.01, 156.6, 260.73, 197.02, 262.34, 243.26, 184.44, 
                           201.59, 112.01, 245.07, 356.71, 174.64, 19.1, 163.78, 108.05, 243.3, 134.63, 212.98, 53.34,
                           226.83, 126.19, 224.96, 321.73, 216.54, 212.88, 221.46, 251.85, 266.34, 191.01, 238.07,
                           228.41, 365.63, 246.68],
                           [161.05, 457.22, 361.9, 182.26, 234.63, 177.12, 182.04, 406.49, 241.9, 0.0, 461.65, 340.33, 
                           474.54, 215.93, 168.19, 435.11, 220.0, 428.65, 110.6, 500.49, 431.35, 487.91, 6.71, 156.98, 
                           114.21, 347.61, 427.39, 360.34, 109.59, 259.02, 326.72, 222.01, 453.86, 373.27, 223.67, 189.42,
                           468.36, 167.84, 298.74, 307.72, 33.62, 164.45, 440.48, 447.67, 503.83, 344.81, 298.73, 314.06,
                           328.67, 488.48],
                           [304.0, 331.51, 125.6, 313.68, 239.71, 305.2, 506.73, 89.87, 249.69, 461.65, 0.0, 247.39, 143.03,
                           260.58, 309.76, 27.2, 243.15, 108.17, 353.17, 219.11, 89.54, 291.89, 465.18, 333.62, 
                           374.64, 146.21, 73.6, 585.19, 361.09, 243.02, 146.49, 242.02, 8.25, 206.93, 456.83, 
                           296.65, 182.54, 297.0, 447.12, 558.96, 429.79, 462.52, 292.21, 42.49, 240.01, 373.45, 
                           462.87, 444.07, 605.02, 161.52],
                           [243.21, 138.22, 128.81, 158.65, 138.23, 168.0, 301.4, 268.53, 113.07, 340.33, 247.39, 0.0, 166.38,
                           144.94, 271.53, 225.29, 174.54, 150.0, 267.53, 165.22, 165.19, 150.45, 340.38, 297.25, 314.04,
                           110.49, 274.85, 342.0, 286.4, 94.2, 228.43, 213.12, 244.01, 47.54, 234.05, 155.6, 142.35, 239.02,
                           204.69, 322.19, 319.51, 262.07, 108.41, 267.71, 165.13, 126.25, 221.06, 199.28, 369.12, 171.82],
                           [339.09, 200.69, 122.87, 297.62, 241.09, 298.39, 465.58, 215.35, 233.28, 474.54, 143.03, 166.38, 0.0,
                            258.79, 357.35, 138.08, 264.32, 56.59, 379.68, 76.11, 68.1, 152.49, 476.19, 384.39, 416.0, 130.68,
                            207.4, 501.65, 394.08, 217.56, 230.36, 285.2, 145.42, 119.1, 400.29, 286.56, 42.54, 332.77, 367.16, 
                            486.39, 447.56, 424.58, 163.93, 182.33, 97.01, 277.36, 383.71, 359.38, 533.32, 20.59],
                            [98.47, 281.02, 148.05, 55.22, 20.88, 44.64, 251.29, 230.23, 31.89, 215.93, 260.58, 144.94,
                            258.79, 0.0, 127.94, 233.38, 41.77, 213.14, 125.64, 290.42, 217.04, 294.16, 217.83, 152.86,
                            169.85, 132.31, 246.85, 365.9, 143.22, 50.93, 157.14, 83.22, 253.62, 165.32, 216.3,
                            36.72, 255.26, 94.67, 239.08, 327.47, 188.88, 206.94, 253.31, 257.61, 296.82, 215.84, 250.87, 244.52, 369.67, 273.28],
                            [32.25, 408.68, 234.83, 145.77, 133.6, 126.15, 293.97, 243.61, 159.15, 168.19, 309.76, 271.53, 357.35, 
                            127.94, 0.0, 284.96, 99.04, 303.66, 62.94, 403.4, 300.7, 418.3, 173.52, 27.2, 65.03, 227.48, 265.28,
                            447.66, 58.6, 177.55, 166.03, 72.5, 301.6, 285.07, 291.8, 133.96, 364.23, 33.84, 339.48, 401.0, 134.62,
                            255.85, 379.8, 289.04, 413.07, 337.38, 347.57, 349.02, 435.81, 375.07],
                            [278.15, 317.05, 100.5, 286.54, 212.51, 277.99, 479.86, 79.76, 222.75, 435.11, 27.2, 225.29, 138.08, 
                            233.38, 284.96, 0.0, 216.23, 94.53, 327.01, 213.56, 76.16, 281.4, 438.56, 309.3, 349.65, 121.08, 69.38, 
                            560.81, 335.38, 216.45, 124.06, 216.28, 20.59, 186.95, 430.73, 269.47, 174.41, 271.15, 422.85, 533.68, 
                            403.4, 435.62, 277.48, 46.53, 233.68, 351.54, 438.46, 420.31, 579.57, 157.89], 
                            [75.47, 312.62, 144.81, 90.21, 37.0, 73.55, 282.45, 200.69, 66.29, 220.0, 243.15, 174.54, 264.32,
                            41.77, 99.04, 216.23, 0.0, 213.51, 116.42, 305.63, 213.79, 319.53, 223.08, 125.87, 152.2, 133.7,
                            219.13, 405.71, 129.81, 82.54, 123.41, 42.05, 235.59, 186.03, 254.06, 71.28, 267.44, 69.63, 280.51,
                            365.86, 189.45, 238.67, 282.17, 234.03, 314.59, 256.24, 292.02, 286.2, 407.02, 280.88],
                            [287.11, 223.49, 69.08, 257.19, 194.03, 255.2, 436.53, 165.74, 191.01, 428.65, 108.17, 150.0, 56.59, 
                            213.14, 303.66, 94.53, 213.51, 0.0, 329.8, 124.65, 18.68, 187.07, 430.79, 330.51, 363.78, 81.05, 161.2, 
                            492.0, 343.11, 177.63, 174.01, 231.22, 107.7, 104.69, 376.85, 244.03, 82.97, 280.59, 354.56, 471.11, 
                            400.28, 393.88, 184.1, 141.03, 143.14, 272.94, 370.87, 349.24, 517.93, 76.69],
                            [50.45, 398.96, 261.22, 117.48, 139.98, 102.0, 233.9, 295.89, 156.6, 110.6, 353.17, 267.53, 379.68, 
                            125.64, 62.94, 327.01, 116.42, 329.8, 0.0, 415.77, 330.17, 417.89, 115.13, 64.26, 50.16, 249.51, 316.83,
                            394.39, 20.62, 175.6, 216.17, 111.88, 345.24, 290.95, 239.88, 113.57, 379.69, 57.27, 296.23, 345.86, 
                            77.47, 197.97, 374.78, 337.58, 422.45, 309.89, 302.24, 307.74, 378.31, 395.55],
                           [380.95, 142.9, 178.6, 318.51, 276.13, 323.93, 463.0, 289.36, 260.73, 500.49, 219.11, 165.22, 76.11,
                           290.42, 403.4, 213.56, 305.63, 124.65, 415.77, 0.0, 140.25, 84.88, 501.17, 430.57, 457.07, 178.97, 282.64, 
                           471.31, 432.38, 242.5, 295.34, 333.59, 221.51, 127.22, 391.15, 311.46, 42.54, 375.25, 344.18, 463.73, 476.81,
                           425.52, 113.53, 258.31, 21.59, 247.94, 360.47, 333.42, 509.95, 58.31], 
                           [285.93, 242.17, 69.46, 263.49, 197.25, 260.12, 446.54, 149.16, 197.02, 431.35, 89.54, 165.19, 68.1,
                           217.04, 300.7, 76.16, 213.79, 18.68, 330.17, 140.25, 0.0, 205.24, 433.76, 327.25, 362.11, 85.15, 143.59, 
                           506.95, 342.58, 184.97, 163.47, 228.23, 89.02, 121.08, 388.75, 249.39, 99.46, 279.25, 369.2, 484.88, 402.2,
                           403.44, 202.77, 122.59, 159.45, 289.35, 385.41, 364.4, 531.59, 88.68],
                           [391.5, 62.61, 221.02, 307.95, 284.95, 318.29, 420.53, 350.89, 262.34, 487.91, 291.89, 150.45, 152.49,
                           294.16, 418.3, 281.4, 319.53, 187.07, 417.89, 84.88, 205.24, 0.0, 487.46, 444.71, 463.9, 213.6, 348.01,
                           403.02, 436.59, 243.24, 340.33, 354.49, 292.87, 135.15, 344.33, 305.94, 110.35, 386.83, 285.51, 402.06, 
                           468.74, 387.83, 50.22, 327.74, 65.19, 188.1, 300.96, 272.34, 446.86, 138.92],
                           [165.52, 456.0, 364.32, 182.73, 236.78, 178.31, 176.14, 410.91, 243.26, 6.71, 465.18, 340.38, 476.19,
                           217.83, 173.52, 438.56, 223.08, 430.79, 115.13, 501.17, 433.76, 487.46, 0.0, 162.86, 120.42, 349.78,
                           431.71, 354.63, 114.95, 260.16, 331.06, 226.15, 457.42, 373.95, 219.13, 190.52, 469.44, 172.26, 294.77,
                           301.96, 38.95, 159.48, 439.79, 451.69, 504.23, 342.43, 294.46, 310.23, 322.5, 489.93],
                           [54.59, 433.87, 261.77, 165.2, 159.79, 146.29, 297.95, 264.27, 184.44, 156.98, 333.62, 297.25, 
                           384.39, 152.86, 27.2, 309.3, 125.87, 330.51, 64.26, 430.57, 327.25, 444.71, 162.86, 0.0, 45.22,
                           254.64, 286.17, 457.83, 51.4, 203.09, 188.45, 99.3, 325.41, 311.85, 302.68, 155.27, 391.43, 
                           58.25, 355.02, 409.76, 124.2, 262.21, 405.62, 311.19, 440.16, 358.52, 362.17, 365.44, 442.56, 402.18],
                           [76.92, 447.3, 294.7, 167.36, 181.4, 151.17, 269.12, 308.1, 201.59, 114.21, 374.64, 314.04, 416.0, 169.85,
                           65.03, 349.65, 152.2, 363.78, 50.16, 457.07, 362.11, 463.9, 120.42, 45.22, 0.0, 285.35, 329.87, 436.61,
                           29.55, 220.69, 231.0, 134.85, 366.49, 334.37, 284.18, 162.29, 419.49, 83.26, 344.22, 386.67, 82.81, 237.31, 
                           421.97, 354.01, 465.03, 360.05, 349.47, 356.26, 416.25, 432.91],
                           [208.43, 228.79, 20.62, 178.49, 113.0, 175.03, 364.72, 158.11, 112.01, 347.61, 146.21, 110.49, 130.68, 132.31,
                           227.48, 121.08, 133.7, 81.05, 249.51, 178.97, 85.15, 213.6, 349.78, 254.64, 285.35, 0.0, 164.58, 439.83, 263.5, 100.96, 
                           127.68, 156.01, 141.23, 85.09, 311.27, 164.25, 138.03, 202.14, 301.98, 412.77, 319.28, 321.07, 190.78, 159.81,
                           191.64, 234.96, 317.49, 299.91, 458.81, 147.73],
                           [266.39, 379.72, 146.15, 302.06, 227.04, 289.5, 498.14, 22.09, 245.07, 427.39, 73.6, 274.85, 207.4, 246.85, 265.28, 
                           69.38, 219.13, 161.2, 316.83, 282.64, 143.59, 348.01, 431.71, 286.17, 329.87, 164.58, 0.0, 597.56, 321.08, 244.0, 100.66, 205.77, 67.42,
                           242.72, 458.02, 283.45, 242.86, 259.56, 461.25, 565.73, 394.27, 453.79, 340.12, 32.65, 302.52, 399.43, 476.02, 460.92, 610.28, 227.26],
                          [418.12, 341.74, 460.35, 316.69, 381.28, 335.68, 179.05, 585.19, 356.71, 360.34, 585.19, 342.0, 501.65, 365.9, 447.66, 560.81, 405.71,
                          492.0, 394.39, 471.31, 506.95, 403.02, 354.63, 457.83, 436.61, 439.83, 597.56, 0.0, 411.66, 354.42, 520.31, 442.46, 580.72, 388.16,
                          155.94, 334.96, 467.85, 420.27, 138.11, 52.95, 372.0, 200.3, 359.61, 598.49, 459.05, 224.96, 122.35, 142.87, 60.54, 501.53],
                          [57.43, 418.71, 274.18, 137.93, 156.25, 122.07, 247.92, 299.72, 174.64, 109.59, 361.09, 286.4, 394.08, 143.22, 58.6, 335.38, 129.81,
                          343.11, 20.62, 432.38, 342.58, 436.59, 114.95, 51.4, 29.55, 263.5, 321.08, 411.66, 0.0, 193.72, 220.78, 119.1, 353.05, 308.42, 257.94,
                           133.41, 395.61, 64.38, 315.94, 362.49, 76.03, 213.74, 394.0, 343.31, 439.63, 330.5, 321.62, 327.68, 393.73, 410.41],
                          [149.01, 231.21, 120.21, 80.16, 45.54, 81.91, 264.32, 230.85, 19.1, 259.02, 243.02, 94.2, 217.56, 50.93, 177.55, 216.45,
                          82.54, 177.63, 175.6, 242.5, 184.97, 243.24, 260.16, 203.09, 220.69, 100.96, 244.0, 354.42, 193.72, 0.0, 168.67, 123.45,
                          237.04, 115.97, 215.23, 69.64, 209.35, 144.84, 220.2, 321.74, 234.39, 220.42, 202.61, 248.32, 247.7, 178.72, 234.09, 222.27,
                          366.5, 230.24],
                          [165.74, 355.86, 119.62, 211.44, 139.63, 196.43, 405.76, 80.01, 163.78, 326.72, 146.49, 228.43, 230.36, 157.14, 166.03, 
                          124.06, 123.41, 174.01, 216.17, 295.34, 163.47, 340.33, 331.06, 188.45, 231.0, 127.68, 100.66, 520.31, 220.78, 168.67,
                          0.0, 105.3, 138.25, 212.13, 373.24, 192.35, 252.8, 158.9, 388.36, 483.87, 293.62, 361.85, 318.28, 123.02, 311.31, 342.24, 
                          401.75, 390.9, 526.62, 250.67], 
                          [62.03, 351.32, 162.5, 125.8, 78.26, 106.89, 309.79, 185.31, 108.05, 222.01, 242.02, 213.12, 285.2, 83.22, 72.5, 216.28, 42.05, 231.22, 
                          111.88, 333.59, 228.23, 354.49, 226.15, 99.3, 134.85, 156.01, 205.77, 442.46, 119.1, 123.45, 105.3, 0.0, 234.0, 219.61, 288.76, 107.91,
                         293.61, 55.04, 320.21, 400.76, 189.24, 267.16, 319.48, 225.73, 344.36, 298.28, 331.14, 326.59, 440.48, 303.18],
                        [296.0, 331.18, 120.62, 306.95, 232.76, 298.2, 500.43, 82.73, 243.3, 453.86, 8.25, 244.01, 145.42, 253.62, 301.6, 20.59, 235.59, 
                        107.7, 345.24, 221.51, 89.02, 292.87, 457.42, 325.41, 366.49, 141.23, 67.42, 580.72, 353.05, 237.04, 138.25, 234.0, 0.0, 204.43, 
                        451.25, 289.8, 184.1, 289.0, 442.71, 553.95, 421.93, 456.18, 291.76, 37.64, 242.21, 370.2, 458.38, 439.93, 599.91, 164.35],
                       [259.79, 143.78, 98.73, 191.32, 153.15, 196.89, 347.2, 239.46, 134.63, 373.27, 206.93, 47.54, 119.1, 165.32, 285.07, 186.95, 186.03, 
                       104.69, 290.95, 127.22, 121.08, 135.15, 373.95, 311.85, 334.37, 85.09, 242.72, 388.16, 308.42, 115.97, 212.13, 219.61, 204.43, 0.0, 281.19, 
                       184.39, 98.33, 254.66, 251.44, 369.48, 349.85, 306.94, 106.3, 231.5, 131.73, 168.32, 267.88, 245.28, 416.43, 125.67],
                      [262.19, 293.97, 331.69, 163.92, 233.77, 181.97, 78.19, 443.38, 212.98, 223.67, 456.83, 234.05, 400.29, 216.3, 291.8, 430.73, 
                      254.06, 376.85, 239.88, 391.15, 388.75, 344.33, 219.13, 302.68, 284.18, 311.27, 458.02, 155.94, 257.94, 215.23, 373.24, 288.76, 
                     451.25, 281.19, 0.0, 182.78, 375.03, 264.38, 80.61, 112.0, 227.69, 61.85, 294.43, 463.54, 385.11, 160.72, 76.55, 97.62, 153.39, 405.66],
                    [101.87, 285.39, 181.34, 19.1, 57.27, 12.53, 214.72, 266.6, 53.34, 189.42, 296.65, 155.6, 286.56, 36.72, 133.96, 269.47, 71.28, 244.03,
                    113.57, 311.46, 249.39, 305.94, 190.52, 155.27, 162.29, 164.25, 283.45, 334.96, 133.41, 69.64, 192.35, 107.91, 289.8, 184.39, 182.78, 
                    0.0, 278.95, 100.45, 213.03, 294.59, 165.48, 170.42, 261.73, 294.31, 315.73, 203.49, 223.49, 220.34, 335.8, 299.7],
                    [342.91, 158.47, 136.5, 287.65, 239.71, 291.25, 443.72, 248.5, 226.83, 468.36, 182.54, 142.35, 42.54, 255.26, 364.23, 174.41, 267.44,
                    82.97, 379.69, 42.54, 99.46, 110.35, 469.44, 391.43, 419.49, 138.03, 242.86, 467.85, 395.61, 209.35, 252.8, 293.61, 184.1, 98.33, 375.03,
                    278.95, 0.0, 337.01, 335.74, 455.54, 443.35, 404.32, 122.44, 220.06, 60.17, 242.89, 352.26, 326.74, 502.31, 34.21], 
                   [7.0, 375.66, 211.51, 113.07, 101.91, 93.19, 273.07, 238.67, 126.19, 167.84, 297.0, 239.02, 332.77, 94.67, 33.84, 271.15, 69.63, 280.59, 57.27, 
                    375.25, 279.25, 386.83, 172.26, 58.25, 83.26, 202.14, 259.56, 420.27, 64.38, 144.84, 158.9, 55.04, 289.0, 254.66, 264.38, 100.45, 337.01, 0.0, 308.37, 
                    374.93, 134.73, 232.9, 347.4, 280.45, 384.03, 303.71, 317.07, 317.35, 411.44, 349.78],
                   [307.79, 229.26, 322.45, 196.79, 251.85, 216.84, 155.32, 449.77, 224.96, 298.74, 447.12, 204.69, 367.16, 239.08, 339.48, 422.85, 
                   280.51, 354.56, 296.23, 344.18, 369.2, 285.51, 294.77, 355.02, 344.22, 301.98, 461.25, 138.11, 315.94, 220.2, 388.36, 320.21,
                   442.71, 251.44, 80.61, 213.03, 335.74, 308.37, 0.0, 119.87, 298.34, 141.87, 237.66, 461.07, 334.57, 97.62, 16.55, 17.2, 166.57, 368.71],
                  [372.34, 343.23, 433.38, 275.81, 344.25, 293.97, 126.15, 552.07, 321.73, 307.72, 558.96, 322.19, 486.39, 327.47, 401.0, 533.68, 365.86, 471.11,
                  345.86, 463.73, 484.88, 402.06, 301.96, 409.76, 386.67, 412.77, 565.73, 52.95, 362.49, 321.74, 483.87, 400.76, 553.95, 369.48, 112.0, 294.59,
                  455.54, 374.93, 119.87, 0.0, 320.16, 149.48, 355.56, 569.08, 453.56, 216.1, 103.41, 130.5, 46.96, 488.39],
                  [127.88, 441.48, 332.78, 160.91, 206.65, 152.97, 196.86, 373.28, 216.54, 33.62, 429.79, 319.51, 447.56, 188.88, 134.62, 403.4, 189.45, 400.28,
                  77.47, 476.81, 402.2, 468.74, 38.95, 124.2, 82.81, 319.28, 394.27, 372.0, 76.03, 234.39, 293.62, 189.24, 421.93, 349.85, 227.69, 165.48, 443.35, 
                 134.73, 298.34, 320.16, 0.0, 172.35, 422.4, 414.97, 481.2, 335.2, 300.19, 312.71, 344.94, 462.16],
                [229.34, 342.35, 340.6, 151.73, 226.88, 165.42,44.42, 437.02, 212.88, 164.45, 462.52, 262.07, 424.58, 206.94, 255.85, 435.62, 238.67, 393.88,
                197.97, 425.52, 403.44, 387.83, 159.48, 262.21, 237.31, 321.07, 453.79, 200.3, 213.74, 220.42, 361.85, 267.16, 456.18, 306.94, 61.85, 170.42, 
                404.32, 232.9, 141.87, 149.48, 172.35, 0.0, 337.62, 463.57, 422.09, 212.44, 138.4, 158.62, 180.36, 432.59], 
                [351.62, 39.62, 202.25, 262.23, 246.29, 273.86, 370.41, 339.85, 221.46, 440.48, 292.21, 108.41, 163.93, 253.31, 379.8, 277.48, 282.17, 184.1,
                374.78, 113.53, 202.77, 50.22, 439.79, 405.62, 421.97, 190.78, 340.12, 359.61, 394.0, 202.61, 318.28, 319.48, 291.76, 106.3, 294.43, 261.73,
                122.44, 347.4, 237.66, 355.56, 422.4, 337.62, 0.0, 323.88, 99.54, 140.04, 253.43, 225.23, 401.0, 155.88],
              [287.39, 363.47, 139.85, 312.37, 237.12, 301.47, 507.99, 52.33, 251.85, 447.67, 42.49, 267.71, 182.33, 257.61, 289.04, 46.53, 234.03, 141.03,
               337.58, 258.31, 122.59, 327.74, 451.69, 311.19, 354.01, 159.81, 32.65, 598.49, 343.31, 248.32, 123.02, 225.73, 37.64, 231.5, 
               463.54, 294.31, 220.06, 280.45, 461.07, 569.08, 414.97, 463.57, 323.88, 0.0, 278.79, 393.69, 476.32, 459.53, 614.39, 201.56],
             [389.51, 125.42, 193.13, 321.57, 283.65, 328.26, 458.39, 308.59, 266.34, 503.83, 240.01, 165.13, 97.01, 296.82, 413.07, 233.68, 314.59,
              143.14, 422.45, 21.59, 159.45, 65.19, 504.23, 440.16, 465.03, 191.64, 302.52, 459.05, 439.63, 247.7, 311.31, 344.36, 242.21, 131.73,
               385.11, 315.73, 60.17, 384.03, 334.57, 453.56, 481.2, 422.09, 99.54, 278.79, 0.0, 237.46, 350.68, 323.07, 499.42, 79.76],
                [305.35, 133.82, 254.17, 193.87, 221.0, 212.26, 238.76, 391.54, 191.01, 344.81, 373.45, 126.25, 277.36, 215.84, 337.38, 351.54,
                 256.24, 272.94, 309.89, 247.94, 289.35, 188.1, 342.43, 358.52, 360.05, 234.96, 399.43, 224.96, 330.5, 178.72, 342.24, 298.28, 370.2,
                  168.32, 160.72, 203.49, 242.89, 303.71, 97.62, 216.1, 335.2, 212.44, 140.04, 393.69, 237.46, 0.0, 113.44, 85.62, 262.08, 276.62], 
                  [316.17, 244.03, 338.01, 206.65, 264.37, 226.59, 147.27, 464.22, 238.07, 298.73, 462.87, 221.06, 383.71, 250.87, 347.57, 438.46, 292.02,
                   370.87, 302.24, 360.47, 385.41, 300.96, 294.46, 362.17, 349.47, 317.49, 476.02, 122.35, 321.62, 234.09, 401.75, 331.14, 458.38, 267.88, 
                   76.55, 223.49, 352.26, 317.07, 16.55, 103.41, 300.19, 138.4, 253.43, 476.32, 350.68, 113.44, 0.0, 29.15, 150.05, 385.25],
                    [317.1, 215.0, 320.22, 204.88, 256.16, 224.98, 172.51, 450.16, 228.41, 314.06, 444.07, 199.28, 359.38, 244.52, 349.02, 420.31,
                     286.2, 349.24, 307.74, 333.42, 364.4, 272.34, 310.23, 365.44, 356.26, 299.91, 460.92, 142.87, 327.68, 222.27, 390.9, 326.59,
                      439.93, 245.28, 97.62, 220.34, 326.74, 317.35, 17.2, 130.5, 312.71, 158.62, 225.23, 459.53, 323.07, 85.62, 29.15, 0.0, 176.53, 360.07], 
                      [408.35, 387.24, 479.42, 316.81, 387.11, 334.25, 148.12, 596.16, 365.63, 328.67, 605.02, 369.12, 533.32, 369.67, 435.81, 579.57, 407.02,
                       517.93, 378.31, 509.95, 531.59, 446.86, 322.5, 442.56, 416.25, 458.81, 610.28, 60.54, 393.73, 366.5, 526.62, 440.48, 599.91, 416.43,
                        153.39, 335.8, 502.31, 411.44, 166.57, 46.96, 344.94, 180.36, 401.0, 614.39, 499.42, 262.08, 150.05, 176.53, 0.0, 535.23],
                         [356.0, 190.88, 141.4, 309.9, 256.22, 311.73, 472.82, 235.64, 246.68, 488.48, 161.52, 171.82, 20.59, 273.28, 375.07, 157.89, 280.88, 
                         76.69, 395.55, 58.31, 88.68, 138.92, 489.93, 402.18, 432.91, 147.73, 227.26, 501.53, 410.41, 230.24, 250.67, 303.18, 164.35, 125.67, 
                         405.66, 299.7, 34.21, 349.78, 368.71, 488.39, 462.16, 432.59, 155.88, 201.56, 79.76, 276.62, 385.25, 360.07, 535.23, 0.0],
                         ])     
                             
                            


    #"""To form the the Demand"""
    # if count ==1:
    data['demands'] =[0, 40, 23, 47, 44, 23, 43, 19, 41, 21, 40, 39, 33, 12, 33, 12, 30, 36, 27, 27, 11, 26, 24, 24, 24, 
                     23, 22, 18, 17, 40, 15, 17, 32, 40, 13, 10, 10, 29, 14, 28, 39, 34, 16,29, 23, 19, 20, 23, 17, 19]

    data['num_vehicles'] = 4
    data['vehicle_capacities'] = [200,200,200,200]


    data['depot'] = 0

    dictSort={}

    for val in range(len(data['demands'])):
        dictSort[val]=data['demands'][val]
 
    print(dictSort)

    #Creating Array which contains details of mandatory nodes to be picked up
    y= sorted(data["demands"],reverse=True)
    print(y)

    temp=0
    if(sum(y)>sum(data['vehicle_capacities'])):
     for testy in y:
        temp=sum(mandatoryNodes)+testy
        if(temp<=sum(data['vehicle_capacities'])):
           mandatoryNodes.append(testy)

    print("Mandatory Nodes To Be Picked")
    print(mandatoryNodes)
    

 

    # To remove dropped nodes from dictionary
    removedOtherNodes=[]

    for key,value in dictSort.items():
        if value not in mandatoryNodes:
            drop_nodes.append(key)
            removedOtherNodes.append(key)
        else:
            mandatoryNodesById.append(key)    

    for x in removedOtherNodes:
        dictSort.pop(x)    
  
    
    print(dictSort)
    return data
    # [END data_model]


def print_solution(data, manager, routing, assignment):
    """Prints assignment on console."""
    print(f'Objective: {assignment.ObjectiveValue()}')
    # Display dropped nodes.
    dropped_nodes = []
    for node in range(routing.Size()):
        if routing.IsStart(node) or routing.IsEnd(node):
            continue
        if assignment.Value(routing.NextVar(node)) == node:
            dropped_nodes.append(manager.IndexToNode(node))

    for x in dropped_nodes:
        if x in mandatoryNodesById:
            mandatoryNodesById.remove(x)
            drop_nodes.append(x) 

    # Display routes
    total_distance = 0
    total_load = 0
    for vehicle_id in range(data['num_vehicles']):
        index = routing.Start(vehicle_id)
        plan_output = 'Route for vehicle {}:\n'.format(vehicle_id)
        route_distance = 0
        route_load = 0
        while not routing.IsEnd(index):
            node_index = manager.IndexToNode(index)
            route_load += data['demands'][node_index]
            plan_output += ' {0} Load({1}) -> '.format(node_index, route_load)
            previous_index = index
            index = assignment.Value(routing.NextVar(index))
            route_distance += routing.GetArcCostForVehicle(
                previous_index, index, vehicle_id)
        plan_output += ' {0} Load({1})\n'.format(manager.IndexToNode(index),
                                                 route_load)
        plan_output += 'Distance of the route: {}m\n'.format(route_distance)
        plan_output += 'Load of the route: {}\n'.format(route_load)
        print(plan_output)
        total_distance += route_distance
        total_load += route_load
    print('Total Distance of all routes: {}m'.format(total_distance))
    print('Total Load of all routes: {}'.format(total_load))
    print("*****************Result of Number of Nodes with Fill level >70% ****************************************")
    node_greaterthan_70=[]
    print("Total Number Of Demands:",len(data['demands']))               
    for val in range(0,len(data['demands'])):
        if(data['demands'][val] >= binSize*0.70 ):
            node_greaterthan_70.append(val)
            
    
    for val in dropped_nodes:
        if (val in node_greaterthan_70 ):
            drop_nodes_greater_than70.append(val)
   
    print("Node id Which must be dropped",sorted(drop_nodes))                
    print("Mandatory Nodes By Id",mandatoryNodesById)
    print("Nodes With fill Level greater than 70% :",node_greaterthan_70) 
    print("Total Number of Nodes With Fill level>70% :",len(node_greaterthan_70))
    print("Total Number of Dropped Nodes With Fill level>70% :",len(drop_nodes_greater_than70))
    print("Total Number of  Visited Nodes Nodes With Fill level>70% :",len(node_greaterthan_70)- len(drop_nodes_greater_than70))
    print("***********************************************************")

def main():
    """Solve the CVRP problem."""
    # Instantiate the data problem.
   # for count in range(1,6):
    data = create_data_model()

    # Create the routing index manager.
    manager = pywrapcp.RoutingIndexManager(len(data['distance_matrix']),
                                           data['num_vehicles'], data['depot'])

    # Create Routing Model.
    routing = pywrapcp.RoutingModel(manager)


    # Create and register a transit callback.
    def distance_callback(from_index, to_index):
        """Returns the distance between the two nodes."""
        # Convert from routing variable Index to distance matrix NodeIndex.
        from_node = manager.IndexToNode(from_index)
        to_node = manager.IndexToNode(to_index)
        return data['distance_matrix'][from_node][to_node]

    transit_callback_index = routing.RegisterTransitCallback(distance_callback)

    # Define cost of each arc.
    routing.SetArcCostEvaluatorOfAllVehicles(transit_callback_index)


    # Add Capacity constraint.
    def demand_callback(from_index):
        """Returns the demand of the node."""
        # Convert from routing variable Index to demands NodeIndex.
        from_node = manager.IndexToNode(from_index)
        return data['demands'][from_node]

    demand_callback_index = routing.RegisterUnaryTransitCallback(
        demand_callback)
    routing.AddDimensionWithVehicleCapacity(
        demand_callback_index,
        0,  # null capacity slack
        data['vehicle_capacities'],  # vehicle maximum capacities
        True,  # start cumul to zero
        'Capacity')
    
    # Allow to drop nodes.
     
    #Adding Penalty To Mandatory Nodes That Need To Be Picked Up

    penalty = 10000
    for node in range(1, len(data['distance_matrix'])):
        
        if(manager.NodeToIndex(node) in mandatoryNodesById):
            routing.AddDisjunction([manager.NodeToIndex(node)], penalty)
        else:
            routing.AddDisjunction([manager.NodeToIndex(node)], 0)

 

    # Setting first solution heuristic.
    search_parameters = pywrapcp.DefaultRoutingSearchParameters()
    search_parameters.first_solution_strategy = (
        routing_enums_pb2.FirstSolutionStrategy.PATH_CHEAPEST_ARC)
    search_parameters.local_search_metaheuristic = (
        routing_enums_pb2.LocalSearchMetaheuristic.GUIDED_LOCAL_SEARCH)
    search_parameters.time_limit.FromSeconds(1)

    # Solve the problem.
    assignment = routing.SolveWithParameters(search_parameters)

    # Print solution on console.
    
    if assignment:
           print_solution(data, manager, routing, assignment)


if __name__ == '__main__':
    main()